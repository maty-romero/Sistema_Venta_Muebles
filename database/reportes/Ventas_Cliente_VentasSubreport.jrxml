<?xml version="1.0" encoding="UTF-8"?>
<!-- Created with Jaspersoft Studio version 6.21.2.final using JasperReports Library version 6.21.2-8434a0bd7c3bbc37cbf916f2968d35e4b165821a  -->
<jasperReport xmlns="http://jasperreports.sourceforge.net/jasperreports" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:schemaLocation="http://jasperreports.sourceforge.net/jasperreports http://jasperreports.sourceforge.net/xsd/jasperreport.xsd" name="Ventas_Cliente_ProductosSubreport" pageWidth="595" pageHeight="842" columnWidth="555" leftMargin="20" rightMargin="20" topMargin="20" bottomMargin="20" uuid="4d00f91f-71d1-49ac-98e2-97738a2e7876">
	<property name="com.jaspersoft.studio.data.sql.tables" value=""/>
	<property name="com.jaspersoft.studio.data.defaultdataadapter" value="Sample DB"/>
	<property name="com.jaspersoft.studio.data.sql.SQLQueryDesigner.sash.w1" value="220"/>
	<property name="com.jaspersoft.studio.data.sql.SQLQueryDesigner.sash.w2" value="769"/>
	<parameter name="ID_Venta" class="java.lang.Integer"/>
	<queryString>
		<![CDATA[SELECT 
    v.id AS id_venta,
    v.nro_pago AS nro_pago,
    v.fecha_venta AS fecha_venta,
    v.codigo_postal_destino AS codigo_postal_destino,
    v.domicilio_destino AS domicilio_destino,
    FORMAT(vd.total_sin_descuento,2,'en_US') AS subtotal,
    FORMAT(vd.monto_descuento,2,'en_US')  AS descuento_monto,
    FORMAT(v.monto_final_venta,2,'en_US') AS monto_final_venta
FROM 
    ventas v
LEFT JOIN 
    (
        (
            SELECT 
                pv.id_venta,
                p.nombre_producto AS nombre_item,
                pv.unidades_vendidas_prod AS unidades,
                pv.precio_venta_prod AS precio_unitario,
                pv.unidades_vendidas_prod * pv.precio_venta_prod AS total
            FROM 
                producto_venta pv
            LEFT JOIN 
                productos p ON p.id = pv.id_producto
        ) 
        UNION 
        (
            SELECT 
                ocv.id_venta,
                oc.nombre_combo AS nombre_item,
                ocv.unidades_vendidas_combo AS unidades,
                ocv.precio_combo AS precio_unitario,
                ocv.unidades_vendidas_combo * ocv.precio_combo AS total
            FROM 
                oferta_combo_venta ocv
            LEFT JOIN 
                oferta_combo oc ON oc.id_oferta_combo = ocv.id_oferta_combo
        )
    ) AS pv ON v.id = pv.id_venta
LEFT JOIN 
    (
        SELECT 
            v.id,
            COALESCE(SUM(total), 0) AS total_sin_descuento,
            (COALESCE(SUM(total), 0) - v.monto_final_venta) AS monto_descuento
        FROM 
            ventas v
        LEFT JOIN 
            (
                SELECT 
                    pv.id_venta,
                    pv.unidades_vendidas_prod * pv.precio_venta_prod AS total
                FROM 
                    producto_venta pv
                UNION ALL
                SELECT 
                    ocv.id_venta,
                    ocv.unidades_vendidas_combo * ocv.precio_combo AS total
                FROM 
                    oferta_combo_venta ocv
                LEFT JOIN 
                    oferta_combo oc ON oc.id_oferta_combo = ocv.id_oferta_combo
            ) AS subquery ON v.id = subquery.id_venta
        GROUP BY 
            v.id
    ) AS vd ON v.id = vd.id
WHERE 
    v.id = $P{ID_Venta}
LIMIT 1;]]>
	</queryString>
	<field name="subtotal" class="java.lang.String"/>
	<field name="descuento_monto" class="java.lang.String"/>
	<field name="monto_final_venta" class="java.lang.String"/>
	<field name="id_venta" class="java.lang.Integer"/>
	<field name="fecha_venta" class="java.sql.Date"/>
	<field name="codigo_postal_destino" class="java.lang.String"/>
	<field name="domicilio_destino" class="java.lang.String"/>
	<background>
		<band splitType="Stretch"/>
	</background>
	<detail>
		<band height="203" splitType="Stretch">
			<subreport>
				<reportElement x="-11" y="34" width="555" height="85" uuid="e1f190f9-fb07-46aa-a0f9-e9bb9ef4c902"/>
				<subreportParameter name="ID_Venta">
					<subreportParameterExpression><![CDATA[$P{ID_Venta}]]></subreportParameterExpression>
				</subreportParameter>
				<connectionExpression><![CDATA[$P{REPORT_CONNECTION}]]></connectionExpression>
				<subreportExpression><![CDATA["Ventas_Cliente_ProductosSubreport.jasper"]]></subreportExpression>
			</subreport>
			<textField>
				<reportElement x="68" y="-20" width="70" height="14" uuid="11f3431c-7821-41aa-96b2-e8c0ed24c5db">
					<property name="com.jaspersoft.studio.spreadsheet.connectionID" value="50192fae-d41c-41f4-8984-c6c0e70bf353"/>
				</reportElement>
				<textElement textAlignment="Left" verticalAlignment="Middle"/>
				<textFieldExpression><![CDATA[$F{id_venta}]]></textFieldExpression>
			</textField>
			<textField>
				<reportElement x="270" y="-6" width="72" height="14" uuid="3a0fa0f0-d4de-46b3-84c9-635fbea063a3">
					<property name="com.jaspersoft.studio.spreadsheet.connectionID" value="ff5b79dc-a0d5-4351-83f5-3072dcdae164"/>
				</reportElement>
				<textElement textAlignment="Left" verticalAlignment="Middle"/>
				<textFieldExpression><![CDATA[$F{domicilio_destino}]]></textFieldExpression>
			</textField>
			<textField>
				<reportElement x="68" y="-6" width="70" height="14" uuid="3e6f4b73-a0b6-4e94-81c1-6e70cf2a4ea4">
					<property name="com.jaspersoft.studio.spreadsheet.connectionID" value="ecdbda65-7d4d-4d0c-a132-ff47d112959b"/>
				</reportElement>
				<textElement textAlignment="Left" verticalAlignment="Middle"/>
				<textFieldExpression><![CDATA[new java.text.SimpleDateFormat("dd-MM-yyyy").format($F{fecha_venta})]]></textFieldExpression>
			</textField>
			<textField>
				<reportElement x="270" y="-20" width="72" height="14" uuid="4842ea88-1228-4eca-bdb7-ba3e512056f0">
					<property name="com.jaspersoft.studio.spreadsheet.connectionID" value="d3b9a315-98b0-4817-b57d-5cb3d36a0731"/>
				</reportElement>
				<textElement textAlignment="Left"/>
				<textFieldExpression><![CDATA[$F{codigo_postal_destino}]]></textFieldExpression>
			</textField>
			<staticText>
				<reportElement x="-11" y="-20" width="79" height="14" forecolor="#030000" uuid="30949902-d3dc-4dde-9469-3bfdaad07641"/>
				<textElement textAlignment="Left" verticalAlignment="Middle">
					<font size="10" isBold="true"/>
				</textElement>
				<text><![CDATA[Nro. de venta:]]></text>
			</staticText>
			<staticText>
				<reportElement x="-11" y="-6" width="79" height="14" forecolor="#030000" uuid="44eddcc7-6fd3-487e-99c7-48549c85cde0"/>
				<textElement textAlignment="Left" verticalAlignment="Middle">
					<font size="10" isBold="true"/>
				</textElement>
				<text><![CDATA[Fecha de venta:]]></text>
			</staticText>
			<staticText>
				<reportElement x="160" y="-6" width="109" height="14" forecolor="#030000" uuid="69c88a78-be07-4714-bec4-e4206cf58ec4"/>
				<textElement textAlignment="Left" verticalAlignment="Middle">
					<font size="10" isBold="true"/>
				</textElement>
				<text><![CDATA[Domicilio de destino:]]></text>
			</staticText>
			<staticText>
				<reportElement x="160" y="-20" width="102" height="14" forecolor="#030000" uuid="c86d9dcd-51b7-4535-a2ff-be5413ac89d8"/>
				<textElement textAlignment="Left" verticalAlignment="Middle">
					<font size="10" isBold="true"/>
				</textElement>
				<text><![CDATA[CÃ³digo postal:]]></text>
			</staticText>
			<rectangle>
				<reportElement x="264" y="122" width="280" height="78" uuid="e61dc92b-26c2-4552-8de6-16fb0f8b90fe"/>
			</rectangle>
			<staticText>
				<reportElement x="274" y="129" width="116" height="20" forecolor="#030303" uuid="481e1e7a-e326-47ca-948d-c5a71927c180"/>
				<textElement textAlignment="Left" verticalAlignment="Middle">
					<font size="10" isBold="true"/>
				</textElement>
				<text><![CDATA[Total parcial:]]></text>
			</staticText>
			<textField>
				<reportElement x="400" y="129" width="134" height="20" uuid="d8820cb2-f322-4b04-9a64-fd526007242d"/>
				<textElement textAlignment="Right"/>
				<textFieldExpression><![CDATA["$"+$F{subtotal}]]></textFieldExpression>
			</textField>
			<staticText>
				<reportElement x="274" y="149" width="116" height="20" forecolor="#030303" uuid="ead65137-49ff-4356-9565-5c026a67df6f"/>
				<textElement textAlignment="Left">
					<font size="10" isBold="true"/>
				</textElement>
				<text><![CDATA[Descuento por monto:]]></text>
			</staticText>
			<textField>
				<reportElement mode="Transparent" x="400" y="149" width="134" height="20" forecolor="#030303" backcolor="#FFFFFF" uuid="2bd4e362-7491-44b1-a31d-4b11f0e3774c"/>
				<textElement textAlignment="Right"/>
				<textFieldExpression><![CDATA[($F{descuento_monto} != null ? "$" + $F{descuento_monto} : "No aplica")]]></textFieldExpression>
			</textField>
			<rectangle>
				<reportElement x="264" y="173" width="280" height="27" forecolor="#000000" backcolor="#030303" uuid="32ff4335-f9f3-47ec-b32b-d0f4a6891e82"/>
			</rectangle>
			<staticText>
				<reportElement x="275" y="177" width="70" height="20" forecolor="#FFFFFF" uuid="e9fd80ba-8d34-4af2-bf89-f8a524727ed8"/>
				<textElement textAlignment="Left" verticalAlignment="Middle">
					<font size="12" isBold="true"/>
				</textElement>
				<text><![CDATA[Total final:]]></text>
			</staticText>
			<textField>
				<reportElement x="400" y="176" width="134" height="23" forecolor="#FFFFFF" uuid="03fbb0d4-7d98-4b2c-903c-6e32086c86b8"/>
				<textElement textAlignment="Right" verticalAlignment="Middle">
					<font size="12" isBold="true"/>
				</textElement>
				<textFieldExpression><![CDATA["$"+$F{monto_final_venta}]]></textFieldExpression>
			</textField>
			<rectangle>
				<reportElement x="-11" y="15" width="555" height="20" forecolor="#FFFFFF" backcolor="#8C8C8C" uuid="76a3228e-0e04-40c7-95a1-a6c4ca8e4ec1"/>
				<graphicElement>
					<pen lineWidth="0.25" lineStyle="Solid" lineColor="#030000"/>
				</graphicElement>
			</rectangle>
			<staticText>
				<reportElement x="439" y="15" width="105" height="20" forecolor="#FFFFFF" uuid="e8852592-0f33-4d45-894e-6ca5066e253f"/>
				<textElement textAlignment="Center" verticalAlignment="Middle">
					<font isBold="true"/>
				</textElement>
				<text><![CDATA[Subtotal]]></text>
			</staticText>
			<staticText>
				<reportElement x="269" y="15" width="101" height="20" forecolor="#FFFFFF" uuid="b6981ddf-6574-46ac-9a28-b4295ebe905c"/>
				<textElement textAlignment="Center" verticalAlignment="Middle">
					<font isBold="true"/>
				</textElement>
				<text><![CDATA[Precio Unitario]]></text>
			</staticText>
			<staticText>
				<reportElement x="-11" y="15" width="91" height="20" forecolor="#FFFFFF" uuid="cecb95b8-770b-41ff-b518-8a0717568c38"/>
				<textElement textAlignment="Center" verticalAlignment="Middle">
					<font isBold="true"/>
				</textElement>
				<text><![CDATA[CÃ³digo]]></text>
			</staticText>
			<staticText>
				<reportElement x="80" y="15" width="189" height="20" forecolor="#FFFFFF" uuid="6df44795-4a63-4ae5-8a37-d29126f0e188"/>
				<textElement textAlignment="Center" verticalAlignment="Middle">
					<font isBold="true"/>
				</textElement>
				<text><![CDATA[DescripciÃ³n]]></text>
			</staticText>
			<staticText>
				<reportElement x="370" y="15" width="69" height="20" forecolor="#FFFFFF" uuid="e31f8047-d292-4077-bc56-93daab7e24fa"/>
				<textElement textAlignment="Center" verticalAlignment="Middle">
					<font isBold="true"/>
				</textElement>
				<text><![CDATA[Cant.]]></text>
			</staticText>
		</band>
	</detail>
</jasperReport>
